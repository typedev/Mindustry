# Snake Units - Мод змееподобных юнитов для Mindustry

## Описание

Snake Units — это продвинутый мод для игры Mindustry, который добавляет уникальных змееподобных юнитов, состоящих из головы и следующих за ней сегментов. Мод реализует сложную систему движения с плавным следованием сегментов, независимо от типа управления (ИИ или ручное).

## Особенности

- **Змееподобные юниты** с головой и 5 сегментами тела
- **Плавное движение** с продвинутой системой сглаживания
- **Независимость от типа управления** — работает как с ИИ, так и с ручным управлением
- **Оптимизированная производительность** с частотой обновления 60 FPS
- **Автоматическое управление ресурсами** с безопасной очисткой памяти
- **Система предотвращения дрожания** для идеально плавного движения

## Структура мода

```
snake-units/
├── mod.json                      # Основная информация о моде
├── content/                      # Игровой контент
│   ├── blocks/                   # Блоки (производство юнитов)
│   │   └── serpent-factory.json  # Фабрика змей
│   └── units/                    # Определения юнитов
│       ├── serpent-head.json     # Голова змеи (управляемая)
│       └── serpent-segment.json  # Сегмент тела змеи
├── sprites/                      # Графические ресурсы
│   ├── blocks/                   # Спрайты блоков
│   │   ├── serpent-factory.png   # Фабрика змей
│   │   └── serpent-factory-top.png # Верхняя часть фабрики
│   └── units/                    # Спрайты юнитов
│       ├── serpent-head.png      # Голова змеи
│       └── serpent-segment.png   # Сегмент тела
├── scripts/                      # Логика мода
│   └── snake-logic.js           # Основная система управления змеями
└── docs/                        # Документация
    ├── TECHNICAL_DOCUMENTATION.md  # Техническая документация
    ├── CONFIGURATION_GUIDE.md      # Руководство по настройке
    └── README.md                   # Этот файл
```

## Установка

1. Скачайте мод в папку `mods/` вашей установки Mindustry
2. Запустите игру и активируйте мод в меню модов
3. Перезапустите игру для применения изменений

## Использование

### Создание змей

1. Постройте **Serpent Factory** (Фабрику змей)
2. Обеспечьте фабрику необходимыми ресурсами
3. Производите юниты **Serpent Head** (Голова змеи)
4. Сегменты тела создаются автоматически при появлении головы

### Управление

- **Ручное управление:** Выберите голову змеи и управляйте как обычным юнитом
- **Командный режим:** Голова следует командам ИИ, сегменты автоматически следуют за головой
- **Групповое управление:** Можете управлять несколькими змеями одновременно

## Технические детали

### Архитектура системы

Мод использует глобальную систему управления `snakeSystem`, которая:

- **Отслеживает все активные змеи** через HashMap по ID головы
- **Обновляется 60 раз в секунду** для максимальной плавности
- **Автоматически создает сегменты** при появлении новых голов
- **Очищает ресурсы** при уничтожении змей

### Алгоритм движения

1. **История позиций головы** — буфер из 20 позиций для сглаживания
2. **Задержанное следование** — первый сегмент следует за головой с задержкой 1 кадр
3. **Каскадное движение** — каждый сегмент следует за предыдущим
4. **Умная логика расстояний:**
   - `< 1.5 единиц` — остановка (устранение дрожания)
   - `> 20 единиц` — мгновенная телепортация
   - `7-20 единиц` — плавная интерполяция

### Система сглаживания

- **Многоуровневое сглаживание** между сегментами
- **Адаптивные пороги движения** для разных ситуаций
- **Предотвращение микродвижений** для устранения дрожания
- **Оптимизированные вычисления** расстояний и углов

## Настройка

### Основные параметры

В файле `scripts/snake-logic.js` можно изменить:

```javascript
maxSegments: 5,        // Количество сегментов (2-20)
segmentSpacing: 10,    // Расстояние между сегментами (8-20)
historySize: 20,       // Размер буфера сглаживания (10-50)
```

### Производительность

```javascript
Timer.schedule(() => {...}, 0, 0.016);  // Частота обновлений (0.016 = 60 FPS)
var minMoveThreshold = 1.5;             // Порог движения (0.5-3.0)
var moveSpeed = 0.25;                   // Скорость интерполяции (0.1-1.0)
```

## Диагностика

Мод включает подробную систему логирования:

```
[Snake] Loading snake logic...
[Snake] Created snake for head 1234
[Snake] Spawned 5 segments
[Snake] Head 1234 became invalid after 1200 updates
[Snake] Cleaning up snake 1234
```

## Решение проблем

### Сегменты не появляются
- Проверьте наличие спрайта `serpent-segment.png`
- Убедитесь, что фабрика производит головы змей
- Проверьте логи на ошибки создания сегментов

### Дрожание сегментов
- Увеличьте `minMoveThreshold` до 2.0
- Уменьшите `moveSpeed` до 0.15
- Увеличьте `historySize` до 30

### Плохая производительность
- Уменьшите частоту обновлений до 30 FPS (0.033)
- Ограничьте количество активных змей
- Уменьшите `historySize` до 10

### Сегменты отстают
- Уменьшите `segmentSpacing` до 8
- Увеличьте `moveSpeed` до 0.4
- Уменьшите задержку первого сегмента

## Расширение мода

### Добавление новых типов

1. **Создайте новые JSON файлы** в `content/units/`
2. **Добавьте спрайты** в `sprites/units/`
3. **Модифицируйте логику** в `scripts/snake-logic.js`

### Новые способности

Можно добавить:
- Атаку всем телом змеи
- Регенерацию сегментов
- Специальные формации
- Взаимодействие между змеями

### Интеграция с другими модами

Мод совместим с большинством других модов благодаря:
- Использованию стандартного API Mindustry
- Изоляции игровой логики
- Корректной обработке событий

## Системные требования

- **Mindustry версии 146 или выше**
- **Java 8+ или эквивалентная Android-версия**
- **Свободная память:** ~10MB для логики мода
- **Производительность:** Рекомендуется 60+ FPS для оптимального опыта

## Известные ограничения

- Максимум рекомендуется **20-30 змей** одновременно для стабильной работы
- Сегменты не могут **атаковать самостоятельно** (только следуют)
- При **очень быстром движении** головы возможны редкие рассинхронизации

## Совместимость

### Протестировано с:
- ✅ Vanilla Mindustry
- ✅ Most content mods
- ✅ UI enhancement mods
- ✅ Graphics mods

### Возможные конфликты:
- ❌ Моды, изменяющие базовую систему юнитов
- ❌ Моды с собственными Timer.schedule системами
- ❌ Моды, переопределяющие события создания/уничтожения юнитов

## Благодарности

- **Сообществу Mindustry** за отличную игру и инструменты модификации
- **Разработчикам Arc Framework** за мощный движок
- **Тестерам мода** за обратную связь и отчеты об ошибках

## Лицензия

Этот мод распространяется под лицензией MIT. Вы можете свободно использовать, модифицировать и распространять код при условии сохранения ссылки на оригинал.

## Версии

### v1.0.0 (текущая)
- Базовая функциональность змеиных юнитов
- Система плавного следования сегментов
- Оптимизированная производительность
- Полная совместимость с ручным и ИИ управлением

### Планы на будущее
- v1.1.0: Дополнительные типы сегментов
- v1.2.0: Специальные способности змей
- v1.3.0: Визуальные эффекты и анимации

---

**Для подробной технической информации см. `docs/TECHNICAL_DOCUMENTATION.md`**

**Для настройки и модификации см. `docs/CONFIGURATION_GUIDE.md`** 